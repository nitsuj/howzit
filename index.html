<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <title>Howzit Brewing - Craft Beer, Good Vibes</title>
  <style>
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background-color: #fff;
      color: #000;
    }
    h1, h2, h3, h4, h5, h6,
    .navbar a,
    .carousel-item div,
    .menu-item-name {
      text-transform: uppercase;
    }
    nav {
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #fff;
      padding: 20px;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(255,255,255,0.1);
    }
    nav img.logo {
      height: 50px;
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1100;
    }
    nav a {
      margin: 0 15px;
      text-decoration: none;
      color: #8517ff;
      font-weight: bold;
      position: relative;
      transition: color 0.3s;
    }
    nav a:hover {
      color: #cea2ff;
    }
    nav a::after {
      content: "";
      position: absolute;
      width: 0%;
      height: 2px;
      bottom: -5px;
      left: 0;
      background-color: #fff;
      transition: width 0.3s;
    }
    nav a:hover::after {
      width: 100%;
    }
    header img.main-img {
      width: 100%;
      display: block;
    }
    section {
      padding: 60px 20px;
      max-width: 1200px;
      margin: 0 auto;
      border-bottom: 1px solid #000;
    }
    h2 {
      font-size: 2rem;
      margin-bottom: 20px;
      color: #8517ff;
    }

    /* TAPLIST + TOGO Grid */
    #taplist .carousel, #togo .carousel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    .carousel-item {
      text-align: center;
    }
    .carousel-item img {
      width: 100%;
      max-width: 250px;
      aspect-ratio: 1 / 1;
      object-fit: cover;
      border-radius: 16px;
      margin: 0 auto;
    }

    /* MERCH STYLING */
    #merch-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    /* CART SIDEBAR */
    #cart {
      position: fixed;
      top: 0;
      right: 0;
      width: 320px;
      height: 100vh;
      background: #111;
      color: #fff;
      box-shadow: -2px 0 10px rgba(0,0,0,0.5);
      padding: 20px;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 10000;
    }
    #cart-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #ff216f;
      color: #000;
      border: none;
      padding: 10px 16px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      z-index: 9999;
    }

    /* TOAST */
    #toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #ff216f;
      color: #000;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.4s;
      z-index: 9999;
    }

    /* EMBEDDED CHECKOUT */
    #embedded-checkout {
      padding: 40px;
      max-width: 600px;
      margin: 40px auto;
      font-family: Montserrat, sans-serif;
      color: #fff;
      background: #111;
      border-radius: 12px;
      display: none;
    }

    /* Responsive nav logo */
    @media screen and (max-width: 768px) {
      nav {
        flex-direction: row;
        justify-content: center;
        padding-top: 60px;
        flex-wrap: wrap;
        position: relative;
      }
      nav img.logo {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        height: 40px;
      }
    }
  </style>
</head>
<body>
  <nav>
    <img src="/howzit/bubble.svg" alt="Logo" class="logo">
    <a href="#taplist">Tap List</a>
    <a href="#togo">To Go</a>
    <a href="#merch">Merch</a>
    <a href="#visit">Visit</a>
    <a href="#faq">FAQ</a>
  </nav>

  <header>
    <img src="https://lh3.googleusercontent.com/p/AF1QipMU-KK2nqWIPUPJ84r54ZiR4hiV08W3_2KnqZTF=s1360-w1360-h1020" alt="Brewery Image" class="main-img">
  </header>

  <section id="merch">
    <h2>Merch</h2>
    <div id="merch-grid"></div>
  </section>

  <div id="toast">Added to cart</div>

  <div id="cart">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h3 style="color: #ff216f;">Your Cart</h3>
      <button onclick="toggleCart(true)" style="background: none; border: none; color: #fff; font-size: 1.2rem; cursor: pointer;">✖</button>
    </div>
    <ul id="cart-items" style="list-style: none; padding: 0;"></ul>
    <button id="checkout-btn" style="margin-top: 20px; padding: 10px 20px; background: #ff216f; color: #000; font-weight: bold; border: none; border-radius: 8px; cursor: pointer;">Checkout</button>
  </div>

  <button id="cart-toggle" onclick="toggleCart()" style="position: fixed; top: 20px; right: 20px;">🛒 Cart</button>

  <div id="embedded-checkout">
    <h2 style="color: #ff216f;">Complete Your Purchase</h2>
    <form id="payment-form">
      <input type="text" id="buyer-name" required placeholder="Full Name"><br>
      <input type="email" id="buyer-email" required placeholder="Email"><br>
      <input type="text" id="buyer-address" required placeholder="Street Address"><br>
      <input type="text" id="buyer-city" required placeholder="City"><br>
      <input type="text" id="buyer-state" required placeholder="State"><br>
      <input type="text" id="buyer-zip" required placeholder="ZIP Code"><br>
      <div id="card-container" style="margin-top:20px;"></div>
      <button id="card-button" type="button" style="margin-top: 20px;">Pay Now</button>
      <div id="payment-status" style="margin-top: 16px;"></div>
    </form>
  </div>

  <section id="taplist">
    <h2>Tap List</h2>
    <div class="carousel-wrapper">
      <div class="carousel" id="taplist-carousel">
        <div class="carousel-item">
          <a href="https://untappd.com/b/howzit-brewing-absorbing-memories/6207395" target="_blank">
            <img src="https://assets.untappd.com/site/beer_logos_hd/beer-6207395_a3e42_hd.jpeg" alt="Absorbing Memories">
            <div>Absorbing Memories</div>
          </a>
        </div>
        <!-- more taplist items here -->
      </div>
    </div>
  </section>

  <section id="togo">
    <h2>To Go</h2>
    <p id="no-togo-message" style="display: none;">No to-go beers at this time.</p>
    <div class="carousel-wrapper" id="togo-wrapper">
      <div class="carousel" id="togo-carousel">
        <div class="carousel-item">
          <a href="https://untappd.com" target="_blank">
            <img src="https://assets.untappd.com/site/beer_logos_hd/beer-5660501_bfc89_hd.jpeg" alt="Can One">
            <div>Can One</div>
          </a>
        </div>
        <!-- more togo items here -->
      </div>
    </div>
  </section>
  <section id="visit" class="contact">
    <h2>Visit Us</h2>
    <p><strong>Address:</strong> 330 Kamani Street, Honolulu, HI</p>
    <div class="hours"><div id="mon">We're open seven days a week from 12pm–10pm</div></div>
    <iframe src="https://www.google.com/maps?q=330+Kamani+Street+Honolulu+HI&output=embed" allowfullscreen></iframe>
  </section>

  <section id="faq">
    <h2>FAQ</h2>
    <div class="faq-entry"><h4>Do you allow dogs?</h4><p>Yes, well behaved dogs are welcome on our outdoor patio.</p></div>
    <div class="faq-entry"><h4>Are kids allowed</h4><p>Kids are allowed but they must be seated by their parent AT ALL TIMES.</p></div>
    <div class="faq-entry"><h4>Do you guys serve food?</h4><p>We do not serve food but we work with a rotating selection of food trucks.</p></div>
    <div class="faq-entry"><h4>Do you have parking?</h4><p>We have three spots in front of the building...</p></div>
    <div class="faq-entry"><h4>How do I get ahold of you?</h4><p>Any questions may be sent via DM on Instagram.</p></div>
  </section>

  <script src="https://sandbox.web.squarecdn.com/v1/square.js"></script>
  <script>
    const cart = [];
    const sizeOrder = ["XS", "Small", "Medium", "Large", "XL", "2XL", "3XL"];

    function toggleCart(forceClose = false) {
      const el = document.getElementById('cart');
      el.style.transform = (forceClose || el.style.transform === 'translateX(0%)') ? 'translateX(100%)' : 'translateX(0%)';
      renderCart();
    }

    function renderCart() {
      const el = document.getElementById('cart-items');
      el.innerHTML = '';
      cart.forEach((item, i) => {
        const li = document.createElement('li');
        li.innerHTML = `${item.title} - ${item.size} <br><strong>Qty:</strong> ${item.quantity} <br><strong>Price:</strong> $${item.price.toFixed(2)}
        <button onclick="removeCartItem(${i})" style="margin-left:10px;">✖</button>`;
        el.appendChild(li);
      });
    }

    function removeCartItem(i) {
      cart.splice(i, 1);
      renderCart();
    }

    function showToast(msg) {
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.style.opacity = 1;
      setTimeout(() => el.style.opacity = 0, 2000);
    }

    async function loadMerch() {
      const res = await fetch('/.netlify/functions/get-skater-tee');
      const product = await res.json();
      const colorMap = {};
      product.variations.forEach(v => {
        const [size, color] = v.name.split(',').map(s => s.trim());
        if (!colorMap[color]) colorMap[color] = [];
        colorMap[color].push({ id: v.id, size, price: v.price, available: v.available });
      });

      const merchGrid = document.getElementById('merch-grid');
      Object.entries(colorMap).forEach(([color, vars]) => {
        const inStock = vars.filter(v => v.available);
        if (!inStock.length) return;

        const card = document.createElement('div');
        card.style = 'background:#111; border:1px solid #ff216f; border-radius:12px; padding:20px; width:260px; color:#fff;';
        card.innerHTML = `
          <img src="${product.image}" style="width:100%; border-radius:8px;" />
          <div style="margin-top:12px; font-weight:bold; color:#ff216f;">Skater Tee - ${color}</div>
          <div style="margin-top:5px;">$${inStock[0].price.toFixed(2)}</div>
        `;

        const select = document.createElement('select');
        select.style = 'margin-top:10px; width:100%; padding:6px;';
        select.innerHTML = '<option value="">-- Select Size --</option>';
        inStock.sort((a, b) => sizeOrder.indexOf(a.size) - sizeOrder.indexOf(b.size)).forEach(v => {
          const opt = document.createElement('option');
          opt.value = JSON.stringify({ id: v.id, size: v.size, price: v.price });
          opt.textContent = v.size;
          select.appendChild(opt);
        });

        const btn = document.createElement('button');
        btn.textContent = 'Add to Cart';
        btn.style = 'margin-top:10px; padding:8px 12px; background:#ff216f; color:#000; font-weight:bold; border:none; border-radius:6px;';
        btn.onclick = () => {
          if (!select.value) return alert('Please select a size');
          const data = JSON.parse(select.value);
          const existing = cart.find(i => i.variation_id === data.id);
          if (existing) existing.quantity += 1;
          else cart.push({ variation_id: data.id, title: `Skater Tee - ${color}`, size: data.size, price: data.price, quantity: 1 });
          renderCart(); showToast('✅ Added to cart');
        };

        card.appendChild(select);
        card.appendChild(btn);
        merchGrid.appendChild(card);
      });
    }

    document.getElementById('checkout-btn').addEventListener('click', () => {
      if (cart.length === 0) return alert('Cart is empty');
      document.getElementById('embedded-checkout').style.display = 'block';
      initializeSquareForm();
    });

    async function initializeSquareForm() {
      const payments = window.Square.payments("sq0idp-do2thVrkpZ500YTQnqF9vg", "LEX59H08FVDAX");
      card = await payments.card();
      await card.attach('#card-container');
    }

    document.getElementById('card-button').addEventListener('click', async () => {
      const result = await card.tokenize();
      if (result.status !== 'OK') return document.getElementById('payment-status').textContent = '❌ Card failed.';

      const payload = {
        token: result.token,
        buyer: {
          name: document.getElementById('buyer-name').value,
          email: document.getElementById('buyer-email').value,
          address: document.getElementById('buyer-address').value,
          city: document.getElementById('buyer-city').value,
          state: document.getElementById('buyer-state').value,
          zip: document.getElementById('buyer-zip').value
        },
        cart
      };

      const res = await fetch('/.netlify/functions/process-embedded-payment', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      document.getElementById('payment-status').textContent = data.success
        ? '✅ Payment successful!'
        : '❌ Payment failed.';
    });

    window.addEventListener('scroll', function() {
      const logo = document.querySelector('.logo');
      logo.style.display = window.scrollY > 50 ? 'none' : 'block';
    });

    loadMerch();
  </script>
</body>
</html>
